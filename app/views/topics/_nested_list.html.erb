<%
  def draw_tree(node)
    node.children.each do |child|
%>
    <div class="card">
      <% if child.leaf? %>
        <div class="card-block">
            <%= child.name %>
            <%= render_form_button(child, @nested_scope) %>
        </div>
      <% else %>
        <div class="card-header" role="tab" id="heading_<%= child.id %>">
          <h5 class="mb-0">
            <a data-toggle="collapse" data-parent="#accordion1" href="#link_<%= child.id %>" aria-expanded="true" aria-controls="link_<%= child.id %>">
              <%= child.name  %><i class="fa fa-chevron-down"></i>
            </a>
          </h5>
        </div>
        <div id="link_<%= child.id %>" class="collapse" role="tabpanel" aria-labelledby="heading_<%= child.id %>">
          <div class="card-block">
            <%= draw_tree(child) %>
          </div>
        </div>
      <% end %>
    </div>
<%
    end; nil
  end
%>
<div class="row">
  <div class="col-sm-6">
    <div id="accordion1" role="tablist" aria-multiselectable="true">
      <% discussion_topic.roots.each do |node| %>
        <div class="card">
          <% if node.leaf? %>
            <div class="card-block">
              <%= node.name %>
            </div>
          <% else %>
            <div class="card-header" role="tab" id="heading_<%= node.id %>">
              <h5 class="mb-0">
                <a data-toggle="collapse" data-parent="#accordion1" href="#link_<%= node.id %>" aria-expanded="true" aria-controls="link_<%= node.id %>">
                  <%= node.name  %><i class="fa fa-chevron-down"></i>
                </a>
              </h5>
            </div>
            <div id="link_<%= node.id %>" class="collapse show" role="tabpanel" aria-labelledby="heading_<%= node.id %>">
              <div class="card-block">
                <%= draw_tree(node) %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  <div class="col-sm-6">
    <div class="form-hook"></div>
  </div>
</div>

<script>
  function renderProcedureTopicForm(int) {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'procedures/procedure_form', f: f %><hr />");
    $('input.procedure-response:last').val(int);
  };
  function renderComplicationTopicForm(int) {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'complications/complication_form', f: f %><hr />");
    $('input.complication-response:last').val(int);
  };
  function renderTestTopicForm(int) {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'tests/test_form', f: f, tests: @tests %>");
    $('input.test-response:last').val(int);
  };
  function renderSymptomTopicForm() {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'tests/test_form', f: f %><hr />");
  };
  function renderDiagnosisTopicForm() {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'diagnoses/diagnosis', f: f %><hr />");
  };
  function renderFamilyMemberTopicForm(int) {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'family_members/family_member_form', f: f, topic: Topic.find(2) %><hr />");
    $('input.family-response:last').val(int);
  };
  function renderMedTopicForm(int) {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'medications/medication_form', f: f %><hr />");
    $('input.med-response:last').val(int);
  };
  function renderStatTopicForm(int) {
    $('.tab-pane.active').find('.form-hook').html("<%= j render 'topics/vital_form', f: f %><hr />");
    $('input.stat-response').val(int);
  };
</script>
