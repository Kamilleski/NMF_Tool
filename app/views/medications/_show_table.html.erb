<div class="card">
  <div class="card-header">
    Medications
  </div>
  <div id="medsCollapse" class="collapse show" role="tabpanel" aria-labelledby="medsHeading">
    <% if medications.length != 0 %>
      <table class="table table-striped table-responsive">
        <% simple_meds = medications.select{ |m| m.common_name == nil } %>
        <% parsed_meds = medications.select{ |m| m.common_name != nil } %>
        <thead>
          <tr>
            <th>Date</th>
            <th>Name</th>
            <th>Instructions</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <% parsed_meds.each do |pm| %>
          <tr>
            <td><%= pm.created_at.strftime("%b %Y") %></td>
            <td><%= "#{pm.name} (#{pm.common_name.upcase}) #{pm.dose} #{pm.dose_unit_of_measurement} #{pm.dosage_form}" %></td>
            <td><%= pm.ingestion_method %></td>
            <td>
              <% if pm.current === true %>
                <%= 'current' %>
              <% elsif pm.current === false %>
                <%= 'discontinued' %>
              <% else %>
                <%= 'unknown' %>
              <% end %>
            </td>
            <td><%= render 'medications/link_buttons', m: pm %></td>
          </tr>
        <% end %>
        <% simple_meds.each do |sm| %>
          <tr>
            <td><%= sm.created_at.strftime("%b %Y") %></td>
            <td><%= "#{sm.name}" %></td>
            <td><%= sm.ingestion_method %></td>
            <td>
              <% if sm.current === true %>
                <%= 'current' %>
              <% elsif sm.current === false %>
                <%= 'discontinued' %>
              <% else %>
                <%= 'not noted' %>
              <% end %>
            </td>
            <td>
              <%= render 'medications/link_buttons', m: sm %>
            </td>
          </tr>
        <% end %>
      </table>
    <% else %>
      Patient does not have any meds on file yet. <%= link_to "Add Some", new_medication_path(@patient), class: "" %>
    <% end %>
  </div>
</div>
